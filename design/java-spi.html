
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Java SPI · Thinking in Java</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Jverson <i@jverson.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="../basic/JDK代理及CGLib代理.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"jiwenxing","repo":"thinking-in-java","type":"star","size":"small","count":true}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://jverson.com" target="_blank" class="custom-link">Jverson's Blog</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                        <b>1.2.</b>
                    
                    Java 多线程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../juc/juc-1-ecosystem.html">
            
                <a href="../juc/juc-1-ecosystem.html">
            
                    
                        <b>1.2.1.</b>
                    
                    Java 并发知识体系
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../juc/juc-2-basic.html">
            
                <a href="../juc/juc-2-basic.html">
            
                    
                        <b>1.2.2.</b>
                    
                    多线程基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../juc/juc-3-thread-creation.html">
            
                <a href="../juc/juc-3-thread-creation.html">
            
                    
                        <b>1.2.3.</b>
                    
                    创建线程的几种方式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../juc/juc-4-threadpool.html">
            
                <a href="../juc/juc-4-threadpool.html">
            
                    
                        <b>1.2.4.</b>
                    
                    线程池的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../juc/juc-forkjoinpool.html">
            
                <a href="../juc/juc-forkjoinpool.html">
            
                    
                        <b>1.2.5.</b>
                    
                    ForkJoinPool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../juc/completefuture.html">
            
                <a href="../juc/completefuture.html">
            
                    
                        <b>1.2.6.</b>
                    
                    CompleteFuture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../juc/juc-8-shardasync.html">
            
                <a href="../juc/juc-8-shardasync.html">
            
                    
                        <b>1.2.7.</b>
                    
                    异步分片请求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../juc/juc-5-thread-collaboration.html">
            
                <a href="../juc/juc-5-thread-collaboration.html">
            
                    
                        <b>1.2.8.</b>
                    
                    线程协作 - wait/notify/notifyAll
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../juc/juc-sleep-yield-join.html">
            
                <a href="../juc/juc-sleep-yield-join.html">
            
                    
                        <b>1.2.9.</b>
                    
                    线程协作 - sleep/yield/join
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../juc/juc-6-jmm.html">
            
                <a href="../juc/juc-6-jmm.html">
            
                    
                        <b>1.2.10.</b>
                    
                    JMM Java 内存模型_
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../juc/juc-7-volatile.html">
            
                <a href="../juc/juc-7-volatile.html">
            
                    
                        <b>1.2.11.</b>
                    
                    volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../juc/juc-8-synchronized.html">
            
                <a href="../juc/juc-8-synchronized.html">
            
                    
                        <b>1.2.12.</b>
                    
                    synchronized & 锁优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../juc/juc-9-lock.html">
            
                <a href="../juc/juc-9-lock.html">
            
                    
                        <b>1.2.13.</b>
                    
                    Lock & ReentrantLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../juc/lock-condition.html">
            
                <a href="../juc/lock-condition.html">
            
                    
                        <b>1.2.14.</b>
                    
                    Lock & Condition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="../juc/juc-10-AQS.html">
            
                <a href="../juc/juc-10-AQS.html">
            
                    
                        <b>1.2.15.</b>
                    
                    AQS 原理_
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="../juc/juc-11-tools.html">
            
                <a href="../juc/juc-11-tools.html">
            
                    
                        <b>1.2.16.</b>
                    
                    并发工具类 - CountDownLatch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="../juc/juc-threadlocal.html">
            
                <a href="../juc/juc-threadlocal.html">
            
                    
                        <b>1.2.17.</b>
                    
                    ThreadLocal 介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                        <b>1.3.</b>
                    
                    异步及响应式编程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../async/completely-async-system.html">
            
                <a href="../async/completely-async-system.html">
            
                    
                        <b>1.3.1.</b>
                    
                    性能优化的角度看异步及全链路异步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../async/rpc-async.html">
            
                <a href="../async/rpc-async.html">
            
                    
                        <b>1.3.2.</b>
                    
                    RPC 框架如何支持异步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../async/rxjava.html">
            
                <a href="../async/rxjava.html">
            
                    
                        <b>1.3.3.</b>
                    
                    RxJava 及响应式编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                        <b>1.4.</b>
                    
                    JVM 虚拟机
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../jvm/jvm-introduction.html">
            
                <a href="../jvm/jvm-introduction.html">
            
                    
                        <b>1.4.1.</b>
                    
                    JVM 宏观认识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../jvm/jvm-components.html">
            
                <a href="../jvm/jvm-components.html">
            
                    
                        <b>1.4.2.</b>
                    
                    JVM 组成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../jvm/jvm-memory-management.html">
            
                <a href="../jvm/jvm-memory-management.html">
            
                    
                        <b>1.4.3.</b>
                    
                    JVM 内存管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../jvm/jvm-gc.html">
            
                <a href="../jvm/jvm-gc.html">
            
                    
                        <b>1.4.4.</b>
                    
                    GC 垃圾回收机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../jvm/classloader.html">
            
                <a href="../jvm/classloader.html">
            
                    
                        <b>1.4.5.</b>
                    
                    ClassLoader 类加载器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                        <b>1.5.</b>
                    
                    算法
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../algorithm/algorithm-summary.html">
            
                <a href="../algorithm/algorithm-summary.html">
            
                    
                        <b>1.5.1.</b>
                    
                    常见算法套路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../algorithm/sort.html">
            
                <a href="../algorithm/sort.html">
            
                    
                        <b>1.5.2.</b>
                    
                    排序算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../algorithm/binary-search.html">
            
                <a href="../algorithm/binary-search.html">
            
                    
                        <b>1.5.3.</b>
                    
                    二分查找
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../algorithm/edit-distance.html">
            
                <a href="../algorithm/edit-distance.html">
            
                    
                        <b>1.5.4.</b>
                    
                    编辑距离与文本相似度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../algorithm/3-aho-corasick.md">
            
                <span>
            
                    
                        <b>1.5.5.</b>
                    
                    AC 算法与字符串搜索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../algorithm/sword-1-str2int.html">
            
                <a href="../algorithm/sword-1-str2int.html">
            
                    
                        <b>1.5.6.</b>
                    
                    sword-1：String 转 int
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../algorithm/sword-8-binary-search.html">
            
                <a href="../algorithm/sword-8-binary-search.html">
            
                    
                        <b>1.5.7.</b>
                    
                    sword-8： 旋转数组的最小数字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../algorithm/sword-15-kth-element.html">
            
                <a href="../algorithm/sword-15-kth-element.html">
            
                    
                        <b>1.5.8.</b>
                    
                    sword-15： 链表中倒数第 k 个节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../algorithm/leetcode-1-twosum.html">
            
                <a href="../algorithm/leetcode-1-twosum.html">
            
                    
                        <b>1.5.9.</b>
                    
                    LeetCode-1： 数组中和为指定值得两个元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../algorithm/leetcode-2-add-two-numbers.html">
            
                <a href="../algorithm/leetcode-2-add-two-numbers.html">
            
                    
                        <b>1.5.10.</b>
                    
                    leetcode-2: 两个链表的数相加
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../algorithm/leetcode-20-valid-parentheses.html">
            
                <a href="../algorithm/leetcode-20-valid-parentheses.html">
            
                    
                        <b>1.5.11.</b>
                    
                    leetcode-20: 合法的括号
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../algorithm/leetcode-26-rm-duplicates-from-sorted-array.html">
            
                <a href="../algorithm/leetcode-26-rm-duplicates-from-sorted-array.html">
            
                    
                        <b>1.5.12.</b>
                    
                    leetcode-26: 删除有序数据中的重复值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../algorithm/leetcode-70-climb-stairs.html">
            
                <a href="../algorithm/leetcode-70-climb-stairs.html">
            
                    
                        <b>1.5.13.</b>
                    
                    leetcode-70: 爬楼梯问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../algorithm/leetcode-21-merge-two-sorted-lists.html">
            
                <a href="../algorithm/leetcode-21-merge-two-sorted-lists.html">
            
                    
                        <b>1.5.14.</b>
                    
                    leetcode-21: 合并两个有序链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../algorithm/leetcode-141-list-cycle.html">
            
                <a href="../algorithm/leetcode-141-list-cycle.html">
            
                    
                        <b>1.5.15.</b>
                    
                    leetcode-141: 环形链表判断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../algorithm/leetcode-206-list-reverse.html">
            
                <a href="../algorithm/leetcode-206-list-reverse.html">
            
                    
                        <b>1.5.16.</b>
                    
                    leetcode-206: 单链表逆转
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                        <b>1.6.</b>
                    
                    设计模式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="0-uml.html">
            
                <a href="0-uml.html">
            
                    
                        <b>1.6.1.</b>
                    
                    UML 类图_
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="1-singleton.html">
            
                <a href="1-singleton.html">
            
                    
                        <b>1.6.2.</b>
                    
                    Singleton 单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="2-builder.html">
            
                <a href="2-builder.html">
            
                    
                        <b>1.6.3.</b>
                    
                    Builder 建造者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../basic/JDK代理及CGLib代理.html">
            
                <a href="../basic/JDK代理及CGLib代理.html">
            
                    
                        <b>1.6.4.</b>
                    
                    代理模式之JDK代理和CGLib代理
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.5" data-path="java-spi.html">
            
                <a href="java-spi.html">
            
                    
                        <b>1.6.5.</b>
                    
                    Java SPI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                        <b>1.7.</b>
                    
                    故障诊断
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../debug/jstack.html">
            
                <a href="../debug/jstack.html">
            
                    
                        <b>1.7.1.</b>
                    
                    Jstack 工具使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../debug/show-busy-java-threads.html">
            
                <a href="../debug/show-busy-java-threads.html">
            
                    
                        <b>1.7.2.</b>
                    
                    show-busy-java-threads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../debug/arthas.html">
            
                <a href="../debug/arthas.html">
            
                    
                        <b>1.7.3.</b>
                    
                    Arthas
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                        <b>1.8.</b>
                    
                    待归档
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../tools/guava-retryer.html">
            
                <a href="../tools/guava-retryer.html">
            
                    
                        <b>1.8.1.</b>
                    
                    重试工具：Guava Retryer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../basic/java-bio-nio-aio.html">
            
                <a href="../basic/java-bio-nio-aio.html">
            
                    
                        <b>1.8.2.</b>
                    
                    Java IO & NIO 介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                        <b>1.9.</b>
                    
                    方法论
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../methodology/software-quality.html">
            
                <a href="../methodology/software-quality.html">
            
                    
                        <b>1.9.1.</b>
                    
                    工程质量建设
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../methodology/mentor.html">
            
                <a href="../methodology/mentor.html">
            
                    
                        <b>1.9.2.</b>
                    
                    怎样做 Mentor？
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                        <b>1.10.</b>
                    
                    Machine Learning
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../ai/knownadge-system.html">
            
                <a href="../ai/knownadge-system.html">
            
                    
                        <b>1.10.1.</b>
                    
                    机器学习知识体系
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../ai/embedding.html">
            
                <a href="../ai/embedding.html">
            
                    
                        <b>1.10.2.</b>
                    
                    Embedding & 预训练
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../ai/ctr-predict.html">
            
                <a href="../ai/ctr-predict.html">
            
                    
                        <b>1.10.3.</b>
                    
                    CTR 预估模型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                        <b>1.11.</b>
                    
                    基础知识
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" >
            
                <span>
            
                    
                        <b>1.11.1.</b>
                    
                    Java 基本概念
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="../basic/初始化和类的加载.html">
            
                <a href="../basic/初始化和类的加载.html">
            
                    
                        <b>1.11.1.1.</b>
                    
                    继承与初始化过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="../basic/多态.html">
            
                <a href="../basic/多态.html">
            
                    
                        <b>1.11.1.2.</b>
                    
                    多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="../basic/抽象类.html">
            
                <a href="../basic/抽象类.html">
            
                    
                        <b>1.11.1.3.</b>
                    
                    抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="../basic/接口.html">
            
                <a href="../basic/接口.html">
            
                    
                        <b>1.11.1.4.</b>
                    
                    接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="../basic/inner-class.html">
            
                <a href="../basic/inner-class.html">
            
                    
                        <b>1.11.1.5.</b>
                    
                    内部类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.6" data-path="../basic/enum.html">
            
                <a href="../basic/enum.html">
            
                    
                        <b>1.11.1.6.</b>
                    
                    枚举
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.7" data-path="../basic/访问权限控制.html">
            
                <a href="../basic/访问权限控制.html">
            
                    
                        <b>1.11.1.7.</b>
                    
                    访问权限控制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.8" data-path="../basic/异常处理.html">
            
                <a href="../basic/异常处理.html">
            
                    
                        <b>1.11.1.8.</b>
                    
                    Java 异常处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.9" data-path="../basic/final.html">
            
                <a href="../basic/final.html">
            
                    
                        <b>1.11.1.9.</b>
                    
                    final 关键字
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" >
            
                <span>
            
                    
                        <b>1.11.2.</b>
                    
                    Java 特性
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="../jdk/lambda_expression.html">
            
                <a href="../jdk/lambda_expression.html">
            
                    
                        <b>1.11.2.1.</b>
                    
                    Lambda 表达式 & 函数式接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="../jdk/interface_function_practise.html">
            
                <a href="../jdk/interface_function_practise.html">
            
                    
                        <b>1.11.2.2.</b>
                    
                    函数式接口 Function 实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="../jdk/double_colon_operator.html">
            
                <a href="../jdk/double_colon_operator.html">
            
                    
                        <b>1.11.2.3.</b>
                    
                    Java8 中的双冒号操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="../jdk/streams_api.html">
            
                <a href="../jdk/streams_api.html">
            
                    
                        <b>1.11.2.4.</b>
                    
                    Java8 中的 Streams API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="../jdk/optional.html">
            
                <a href="../jdk/optional.html">
            
                    
                        <b>1.11.2.5.</b>
                    
                    Java Optional 类的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.6" data-path="../jdk/map_api.html">
            
                <a href="../jdk/map_api.html">
            
                    
                        <b>1.11.2.6.</b>
                    
                    Java8 中的 Map API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.7" data-path="../jdk/behavior_parameterization.html">
            
                <a href="../jdk/behavior_parameterization.html">
            
                    
                        <b>1.11.2.7.</b>
                    
                    行为参数化（Behavior parameterization）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.8" data-path="../jdk/comparator-sort.html">
            
                <a href="../jdk/comparator-sort.html">
            
                    
                        <b>1.11.2.8.</b>
                    
                    Comparator 与排序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" >
            
                <span>
            
                    
                        <b>1.11.3.</b>
                    
                    Java 泛型及反射
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="../basic/generics.html">
            
                <a href="../basic/generics.html">
            
                    
                        <b>1.11.3.1.</b>
                    
                    Java 泛型的理解和使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3.2" data-path="../basic/type.html">
            
                <a href="../basic/type.html">
            
                    
                        <b>1.11.3.2.</b>
                    
                    泛型中的 Type 接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3.3" data-path="../jvm/java-reflection-class.html">
            
                <a href="../jvm/java-reflection-class.html">
            
                    
                        <b>1.11.3.3.</b>
                    
                    Class 对象 - Java 类型信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3.4" data-path="../jvm/java-reflection.html">
            
                <a href="../jvm/java-reflection.html">
            
                    
                        <b>1.11.3.4.</b>
                    
                    Java 反射特性
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.4" >
            
                <span>
            
                    
                        <b>1.11.4.</b>
                    
                    数据结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.4.1" data-path="../data-types/string.html">
            
                <a href="../data-types/string.html">
            
                    
                        <b>1.11.4.1.</b>
                    
                    字符串基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.2" data-path="../data-types/collection.html">
            
                <a href="../data-types/collection.html">
            
                    
                        <b>1.11.4.2.</b>
                    
                    容器(持有对象)的基本概念及操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.3" data-path="../data-types/list-interface.html">
            
                <a href="../data-types/list-interface.html">
            
                    
                        <b>1.11.4.3.</b>
                    
                    List 接口及实现类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.4" data-path="../data-types/queue-interface.html">
            
                <a href="../data-types/queue-interface.html">
            
                    
                        <b>1.11.4.4.</b>
                    
                    Queue 接口及实现类概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.5" data-path="../data-types/PriorityQueue.html">
            
                <a href="../data-types/PriorityQueue.html">
            
                    
                        <b>1.11.4.5.</b>
                    
                    PriorityQueue 和 Heap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.6" data-path="../data-types/BlockingQueue.html">
            
                <a href="../data-types/BlockingQueue.html">
            
                    
                        <b>1.11.4.6.</b>
                    
                    BlockingQueue 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.7" data-path="../data-types/ArrayBlockingQueue.md">
            
                <span>
            
                    
                        <b>1.11.4.7.</b>
                    
                    ArrayBlockingQueue 源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.8" data-path="../data-types/set-interface.html">
            
                <a href="../data-types/set-interface.html">
            
                    
                        <b>1.11.4.8.</b>
                    
                    Set 接口及实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.9" data-path="../data-types/HashMap.html">
            
                <a href="../data-types/HashMap.html">
            
                    
                        <b>1.11.4.9.</b>
                    
                    HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.10" data-path="../data-types/ConcurrentHashMap.html">
            
                <a href="../data-types/ConcurrentHashMap.html">
            
                    
                        <b>1.11.4.10.</b>
                    
                    ConcurrentHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.11" data-path="../data-types/HashMap-Hashtable-CocurrentHashMap.html">
            
                <a href="../data-types/HashMap-Hashtable-CocurrentHashMap.html">
            
                    
                        <b>1.11.4.11.</b>
                    
                    HashMap、HashTable & ConcurrentHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4.12" data-path="../data-types/TreeMap-LinkedHashMap.html">
            
                <a href="../data-types/TreeMap-LinkedHashMap.html">
            
                    
                        <b>1.11.4.12.</b>
                    
                    TreeMap 和 LinkedHashMap 介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Java SPI</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="java-spi">Java SPI</h1>
<hr>
<h1 id="overview">Overview</h1>
<p>&#x4E00;&#x4E2A;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x822C;&#x8981;&#x6C42;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E0D;&#x6539;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x800C;&#x53EA;&#x662F;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x7279;&#x5B9A;&#x63A5;&#x53E3;&#x5E76;&#x63D0;&#x4F9B;&#x63D2;&#x4EF6;&#x5C31;&#x80FD;&#x5BF9;&#x6E90;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x5404;&#x79CD;&#x529F;&#x80FD;&#x6269;&#x5C55;&#x3002;&#x800C;&#x4ECE; Java6 &#x5F00;&#x59CB; JDK &#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x548C;&#x52A0;&#x8F7D;&#x7279;&#x5B9A;&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x662F;&#x4E00;&#x5957;&#x7528;&#x6765;&#x88AB;&#x7B2C;&#x4E09;&#x65B9;&#x5B9E;&#x73B0;&#x6216;&#x8005;&#x6269;&#x5C55;&#x7684;API&#xFF0C;&#x4F7F;&#x7528;&#x5B83;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x5B9E;&#x73B0;&#x6846;&#x67B6;&#x6269;&#x5C55;&#x548C;&#x66FF;&#x6362;&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x5728;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x4E2D;&#x6211;&#x4EEC;&#x63A8;&#x8350;&#x57FA;&#x4E8E;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;&#xFF0C;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x57FA;&#x4E8E;&#x63A5;&#x53E3;&#x4EA4;&#x4E92;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x663E;&#x800C;&#x6613;&#x89C1;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x8FDB;&#x884C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7684;&#x786C;&#x7F16;&#x7801;&#xFF0C;&#x800C;&#x8BA9;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#x8005;&#x6309;&#x7167;&#x63A5;&#x53E3;&#x89C4;&#x8303;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x5185;&#x90E8;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x518D;&#x6839;&#x636E; SPI &#x7684;&#x89C4;&#x8303;&#x53BB;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x3002;&#x901A;&#x8FC7; SPI &#x670D;&#x52A1;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x7684;&#x6CE8;&#x518C;&#x548C;&#x53D1;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x907F;&#x514D;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5C06;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5199;&#x6B7B;&#x3002;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;&#xFF0C;&#x5B9E;&#x73B0;&#x6A21;&#x5757;&#x95F4;&#x7684;&#x89E3;&#x8026;&#x3002;</p>
<blockquote>
<p>An extensible application is one that you can extend without modifying its original code base. You can enhance its functionality with new plug-ins or modules. Developers, software vendors can add new functionality or application programming interfaces (APIs) by adding a new Java Archive (JAR) file onto the application class path or into an application-specific extension directory.</p>
</blockquote>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x57FA;&#x4E8E; Oracle &#x7684;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0; <a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html" target="_blank">Creating Extensible Applications</a> &#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B; Java SPI &#x673A;&#x5236;&#x3002;</p>
<h1 id="dictionary-service-example">Dictionary Service Example</h1>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x8981;&#x7ED9;&#x67D0;&#x4E2A;&#x7F16;&#x8F91;&#x5668;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x5B57;&#x5178;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8981;&#x6C42;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x8981;&#x5BF9;&#x5B57;&#x5178;&#x8FDB;&#x884C;&#x6269;&#x5C55;</p>
<h2 id="define-the-service-provider-interface">Define the Service Provider Interface</h2>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Dictionary</span> </span>{
    <span class="hljs-function">String <span class="hljs-title">getDefinition</span><span class="hljs-params">(String word)</span></span>;
}
</code></pre>
<h2 id="&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x7684;-dictionaryservice-&#x4EE3;&#x7406;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF08;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#xFF09;">&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x7684; DictionaryService &#x4EE3;&#x7406;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF08;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#xFF09;</h2>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DictionaryService</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DictionaryService service;
    <span class="hljs-keyword">private</span> ServiceLoader&lt;Dictionary&gt; loader;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">DictionaryService</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">// Singleton</span>
        loader = ServiceLoader.load(Dictionary.class);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> DictionaryService <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (service == <span class="hljs-keyword">null</span>) {
            service = <span class="hljs-keyword">new</span> DictionaryService();
        }
        <span class="hljs-keyword">return</span> service;
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDefinition</span><span class="hljs-params">(String word)</span> </span>{
        String definition = <span class="hljs-keyword">null</span>;

        <span class="hljs-keyword">try</span> {
            Iterator&lt;Dictionary&gt; dictionaries = loader.iterator();
            <span class="hljs-keyword">while</span> (definition == <span class="hljs-keyword">null</span> &amp;&amp; dictionaries.hasNext()) {
                Dictionary d = dictionaries.next();
                definition = d.getDefinition(word);
            }
        } <span class="hljs-keyword">catch</span> (ServiceConfigurationError serviceError) {
            definition = <span class="hljs-keyword">null</span>;
            serviceError.printStackTrace();

        }
        <span class="hljs-keyword">return</span> definition;
    }
}
</code></pre>
<h2 id="implement-the-service-provider">Implement the Service Provider</h2>
<p>&#x57FA;&#x7840;&#x5B9E;&#x73B0;</p>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeneralDictionary</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Dictionary</span> </span>{
    <span class="hljs-keyword">private</span> SortedMap&lt;String, String&gt; map;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GeneralDictionary</span><span class="hljs-params">()</span> </span>{
        map = <span class="hljs-keyword">new</span> TreeMap&lt;String, String&gt;();
        map.put(
                <span class="hljs-string">&quot;book&quot;</span>,
                <span class="hljs-string">&quot;a set of written or printed pages, usually bound with &quot;</span> +
                        <span class="hljs-string">&quot;a protective cover&quot;</span>);
        map.put(
                <span class="hljs-string">&quot;editor&quot;</span>,
                <span class="hljs-string">&quot;a person who edits&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDefinition</span><span class="hljs-params">(String word)</span> </span>{
        <span class="hljs-keyword">return</span> map.get(word);
    }
}
</code></pre>
<p>&#x6269;&#x5C55;&#x5B9E;&#x73B0;</p>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExtendedDictionary</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Dictionary</span> </span>{
    <span class="hljs-keyword">private</span> SortedMap&lt;String, String&gt; map;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ExtendedDictionary</span><span class="hljs-params">()</span> </span>{
        map = <span class="hljs-keyword">new</span> TreeMap&lt;&gt;();
        map.put(
                <span class="hljs-string">&quot;xml&quot;</span>,
                <span class="hljs-string">&quot;a document standard often used in web services, among other &quot;</span> +
                        <span class="hljs-string">&quot;things&quot;</span>);
        map.put(
                <span class="hljs-string">&quot;REST&quot;</span>,
                <span class="hljs-string">&quot;an architecture style for creating, reading, updating, &quot;</span> +
                        <span class="hljs-string">&quot;and deleting data that attempts to use the common &quot;</span> +
                        <span class="hljs-string">&quot;vocabulary of the HTTP protocol; Representational State &quot;</span> +
                        <span class="hljs-string">&quot;Transfer&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDefinition</span><span class="hljs-params">(String word)</span> </span>{
        <span class="hljs-keyword">return</span> map.get(word);
    }
}
</code></pre>
<h2 id="&#x6CE8;&#x518C;-service-providers">&#x6CE8;&#x518C; Service Providers</h2>
<p>&#x5728; resources &#x4E0B;&#x521B;&#x5EFA; <code>META-INF/services</code> &#x76EE;&#x5F55;&#xFF0C;&#x4EE5;&#x63A5;&#x53E3;&#x5168;&#x8DEF;&#x5F84;&#x540D;&#x4E3A;&#x6587;&#x4EF6;&#x540D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5185;&#x5BB9;&#x4E3A; fully qualified class names of your service providers, one name per line. The file must be UTF-8 encoded&#x3002;</p>
<pre><code>library/src/main/resources
&#x2514;&#x2500;&#x2500; META-INF
    &#x2514;&#x2500;&#x2500; services
        &#x2514;&#x2500;&#x2500; com.jverson.springboot.service.Dictionary
</code></pre><p>&#x5176;&#x4E2D; <code>com.jverson.springboot.service.Dictionary</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;</p>
<pre><code>com.jverson.springboot.impl.GeneralDictionary
com.jverson.springboot.impl.ExtendedDictionary
</code></pre><h2 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h2>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestJavaSPI</span> </span>{

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSPI</span><span class="hljs-params">()</span> </span>{
        DictionaryService dictionary = DictionaryService.getInstance();
        System.out.println(TestJavaSPI.lookup(dictionary, <span class="hljs-string">&quot;book&quot;</span>));
        System.out.println(TestJavaSPI.lookup(dictionary, <span class="hljs-string">&quot;editor&quot;</span>));
        System.out.println(TestJavaSPI.lookup(dictionary, <span class="hljs-string">&quot;xml&quot;</span>));
        System.out.println(TestJavaSPI.lookup(dictionary, <span class="hljs-string">&quot;REST&quot;</span>));
        System.out.println(TestJavaSPI.lookup(dictionary, <span class="hljs-string">&quot;html&quot;</span>));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">lookup</span><span class="hljs-params">(DictionaryService dictionary, String word)</span> </span>{
        String outputString = word + <span class="hljs-string">&quot;: &quot;</span>;
        String definition = dictionary.getDefinition(word);
        <span class="hljs-keyword">if</span> (definition == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> outputString + <span class="hljs-string">&quot;Cannot find definition for this word.&quot;</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> outputString + definition;
        }
    }

}
</code></pre>
<h2 id="terms-and-definitions-of-java-spi">Terms and Definitions of Java SPI</h2>
<p>&#x7531;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x770B;&#x5230; SPI &#x5305;&#x542B;&#x51E0;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x7EC4;&#x4EF6;</p>
<ol>
<li>Service(e.g. DictionaryService)&#xFF1A;A well-known set of programming interfaces and classes that provide access to some specific application functionality or feature.</li>
<li>Service Provider Interface&#xFF08;e.g. Dictionary&#xFF09;&#xFF1A;An interface or abstract class that acts as a proxy or an endpoint to the service.</li>
<li>Service Provider(e.g. GeneralDictionary)&#xFF1A;A specific implementation of the SPI. A Service Provider is configured and identified through a provider configuration file which we put in the resource directory META-INF/services. The file name is the fully-qualified name of the SPI and its content is the fully-qualified name of the SPI implementation. The Service Provider is installed in the form of extensions, a jar file which we place in the application classpath, the Java extension classpath or the user-defined classpath.</li>
<li>ServiceLoader&#xFF1A;At the heart of the SPI is the ServiceLoader class. This has the role of discovering and loading implementations lazily. It uses the context classpath to locate provider implementations and put them in an internal cache.</li>
</ol>
<h2 id="serviceloader-&#x6E90;&#x7801;&#x89E3;&#x6790;">ServiceLoader &#x6E90;&#x7801;&#x89E3;&#x6790;</h2>
<p>&#x76F4;&#x63A5;&#x4ECE; ServiceLoader &#x7C7B;&#x7684; load &#x65B9;&#x6CD5;&#x770B;&#x8D77;</p>
<pre><code class="lang-Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;S&gt; <span class="hljs-function">ServiceLoader&lt;S&gt; <span class="hljs-title">load</span><span class="hljs-params">(Class&lt;S&gt; service)</span> </span>{
    <span class="hljs-comment">//1.&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;</span>
    ClassLoader cl = Thread.currentThread().getContextClassLoader();
    <span class="hljs-keyword">return</span> ServiceLoader.load(service, cl);
}

<span class="hljs-comment">//&#x6784;&#x9020;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ServiceLoader</span><span class="hljs-params">(Class&lt;S&gt; svc, ClassLoader cl)</span> </span>{
    <span class="hljs-comment">//&#x5224;&#x65AD;&#x5165;&#x53C2;&#x662F;&#x5426;&#x4E3A;null</span>
    service = Objects.requireNonNull(svc, <span class="hljs-string">&quot;Service interface cannot be null&quot;</span>);
    <span class="hljs-comment">//2.&#x52A0;&#x8F7D;&#x5668;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x83B7;&#x53D6;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x901A;&#x5E38;&#x662F;applicationLoader&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x52A0;&#x8F7D;&#x5668;</span>
    loader = (cl == <span class="hljs-keyword">null</span>) ? ClassLoader.getSystemClassLoader() : cl;
    <span class="hljs-comment">//3.&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5668;</span>
    acc = (System.getSecurityManager() != <span class="hljs-keyword">null</span>) ? AccessController.getContext() : <span class="hljs-keyword">null</span>;
    reload();
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reload</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// &#x6E05;&#x7A7A;&#x7F13;&#x5B58;</span>
    providers.clear();
    <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x7528;&#x4E8E;&#x904D;&#x5386;&#x63D0;&#x4F9B;&#x8005;</span>
    lookupIterator = <span class="hljs-keyword">new</span> LazyIterator(service, loader);
}

<span class="hljs-comment">// &#x8FD9;&#x91CC;&#x518D;&#x6765;&#x770B; ServiceLoader &#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;</span>

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PREFIX = <span class="hljs-string">&quot;META-INF/services/&quot;</span>;

<span class="hljs-comment">// &#x8981;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Class&lt;S&gt; service;

<span class="hljs-comment">// &#x7528;&#x4E8E;&#x52A0;&#x8F7D;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ClassLoader loader;

<span class="hljs-comment">// &#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5668;</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccessControlContext acc;

<span class="hljs-comment">// &#x63D0;&#x4F9B;&#x8005;&#x7684;&#x7F13;&#x5B58;</span>
<span class="hljs-keyword">private</span> LinkedHashMap&lt;String,S&gt; providers = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();

<span class="hljs-comment">// &#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x7528;&#x4E8E;&#x904D;&#x5386;&#x5B9E;&#x73B0;&#x7C7B;</span>
<span class="hljs-keyword">private</span> LazyIterator lookupIterator;

<span class="hljs-comment">// &#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x91CD;&#x70B9;&#x5C31;&#x5728;&#x4E8E; LazyIterator &#x8FD9;&#x4E2A;&#x5185;&#x90E8;&#x7C7B;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x83B7;&#x53D6;&#x5B9E;&#x73B0;&#x7C7B;&#x90FD;&#x770B;&#x8FD9;&#x4E2A;&#x5185;&#x90E8;&#x7C7B;</span>

<span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyIterator</span>
    <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">S</span>&gt;
</span>{

    Class&lt;S&gt; service;
    ClassLoader loader;
    Enumeration&lt;URL&gt; configs = <span class="hljs-keyword">null</span>;
    Iterator&lt;String&gt; pending = <span class="hljs-keyword">null</span>;
    String nextName = <span class="hljs-keyword">null</span>;

  <span class="hljs-comment">//&#x6784;&#x9020;&#x51FD;&#x6570;</span>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">LazyIterator</span><span class="hljs-params">(Class&lt;S&gt; service, ClassLoader loader)</span> </span>{
      <span class="hljs-keyword">this</span>.service = service;
      <span class="hljs-keyword">this</span>.loader = loader;
  }

  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNextService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (nextName != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">if</span> (configs == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">//&#x83B7;&#x53D6;META-INF/services&#x4E0B;&#x6587;&#x4EF6;&#x5168;&#x79F0;</span>
                String fullName = PREFIX + service.getName();
                <span class="hljs-keyword">if</span> (loader == <span class="hljs-keyword">null</span>)
                    configs = ClassLoader.getSystemResources(fullName);
                <span class="hljs-keyword">else</span>
                    <span class="hljs-comment">//&#x83B7;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5185;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7684;&#x679A;&#x4E3E;&#x7C7B;</span>
                    configs = loader.getResources(fullName);
            } <span class="hljs-keyword">catch</span> (IOException x) {
                fail(service, <span class="hljs-string">&quot;Error locating configuration files&quot;</span>, x);
            }
        }
        <span class="hljs-keyword">while</span> ((pending == <span class="hljs-keyword">null</span>) || !pending.hasNext()) {
            <span class="hljs-keyword">if</span> (!configs.hasMoreElements()) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }
            pending = parse(service, configs.nextElement());
        }
        nextName = pending.next();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

  <span class="hljs-function"><span class="hljs-keyword">private</span> S <span class="hljs-title">nextService</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (!hasNextService())
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
      <span class="hljs-comment">//&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x83B7;&#x53D6;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x540D;</span>
      String cn = nextName;
      nextName = <span class="hljs-keyword">null</span>;
      Class&lt;?&gt; c = <span class="hljs-keyword">null</span>;
      <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//&#x5B9E;&#x4F8B;&#x5316;&#x5B9E;&#x73B0;&#x7C7B;</span>
          c = Class.forName(cn, <span class="hljs-keyword">false</span>, loader);
      } <span class="hljs-keyword">catch</span> (ClassNotFoundException x) {
          fail(service,
               <span class="hljs-string">&quot;Provider &quot;</span> + cn + <span class="hljs-string">&quot; not found&quot;</span>);
      }
      <span class="hljs-keyword">if</span> (!service.isAssignableFrom(c)) {
          fail(service,
               <span class="hljs-string">&quot;Provider &quot;</span> + cn  + <span class="hljs-string">&quot; not a subtype&quot;</span>);
      }
      <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//&#x8FD9;&#x4E00;&#x884C;&#x5C06;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x7C7B;&#x5F3A;&#x8F6C;&#x6210;&#x6240;&#x8868;&#x793A;&#x7684;&#x7C7B;&#x578B;</span>
          S p = service.cast(c.newInstance());
          <span class="hljs-comment">//&#x7F13;&#x5B58;&#x5B9E;&#x73B0;&#x7C7B;</span>
          providers.put(cn, p);
          <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;</span>
          <span class="hljs-keyword">return</span> p;
      } <span class="hljs-keyword">catch</span> (Throwable x) {
          fail(service,
               <span class="hljs-string">&quot;Provider &quot;</span> + cn + <span class="hljs-string">&quot; could not be instantiated&quot;</span>,
               x);
      }
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error();          <span class="hljs-comment">// This cannot happen</span>
  }
</code></pre>
<h1 id="spi-samples-in-the-java-ecosystem">SPI Samples in the Java Ecosystem</h1>
<p>Java provides many SPIs. Here are some samples of the service provider interface and the service that it provides:</p>
<ul>
<li>CurrencyNameProvider: provides localized currency symbols for the Currency class.</li>
<li>LocaleNameProvider: provides localized names for the Locale class.</li>
<li>TimeZoneNameProvider: provides localized time zone names for the TimeZone class.</li>
<li>DateFormatProvider: provides date and time formats for a specified locale.</li>
<li>NumberFormatProvider: provides monetary, integer and percentage values for the NumberFormat class.</li>
<li>Driver: as of version 4.0, the JDBC API supports the SPI pattern. Older versions uses the Class.forName() method to load drivers.</li>
<li>PersistenceProvider: provides the implementation of the JPA API.</li>
<li>JsonProvider: provides JSON processing objects.</li>
<li>JsonbProvider: provides JSON binding objects.</li>
<li>Extension: provides extensions for the CDI container.</li>
<li>ConfigSourceProvider: provides a source for retrieving configuration properties.</li>
</ul>
<h1 id="summary">Summary</h1>
<p>The easiest way to create an extensible application is to use the ServiceLoader, which is available for Java SE 6 and later. Using this class, you can add provider implementations to the application class path to make new functionality available. The ServiceLoader class is final, so you cannot modify its abilities.</p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html" target="_blank">Creating Extensible Applications</a></li>
<li><a href="https://www.baeldung.com/java-spi" target="_blank">Java Service Provider Interface</a></li>
<li><a href="https://segmentfault.com/a/1190000022101812" target="_blank">Java SPI&#x6E90;&#x7801;&#x89E3;&#x6790;&#x53CA;demo&#x8BB2;&#x89E3;</a></li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; jverson.com 2019 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification"><span></span>
15:12
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../basic/JDK代理及CGLib代理.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 代理模式之JDK代理和CGLib代理">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Java SPI","level":"1.6.5","depth":2,"next":{"title":"故障诊断","level":"1.7","depth":1,"ref":"","articles":[{"title":"Jstack 工具使用","level":"1.7.1","depth":2,"path":"debug/jstack.md","ref":"debug/jstack.md","articles":[]},{"title":"show-busy-java-threads","level":"1.7.2","depth":2,"path":"debug/show-busy-java-threads.md","ref":"debug/show-busy-java-threads.md","articles":[]},{"title":"Arthas","level":"1.7.3","depth":2,"path":"debug/arthas.md","ref":"debug/arthas.md","articles":[]}]},"previous":{"title":"代理模式之JDK代理和CGLib代理","level":"1.6.4","depth":2,"path":"basic/JDK代理及CGLib代理.md","ref":"basic/JDK代理及CGLib代理.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","github-buttons","disqus","todo","splitter","tbfed-pagefooter","page-toc-button","-sharing","expandable-chapters"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © jverson.com 2019","modify_label":"<span></span>","modify_format":"HH:mm"},"disqus":{"useIdentifier":false,"shortName":"jverson"},"github":{"url":"https://github.com/jiwenxing/thinking-in-java"},"todo":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"github-buttons":{"buttons":[{"user":"jiwenxing","repo":"thinking-in-java","type":"star","size":"small","count":true}]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"expandable-chapters":{}},"theme":"default","author":"Jverson <i@jverson.com>","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"isbn":"","variables":{},"title":"Thinking in Java","links":{"sidebar":{"Jverson's Blog":"https://jverson.com"}},"gitbook":"*","description":"Thinking in Java","extension":null},"file":{"path":"design/java-spi.md","mtime":"2021-07-18T07:12:21.777Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-09T02:11:01.409Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

